\documentclass{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{enumitem}
\usepackage{lmodern}
\usepackage{booktabs}
\usepackage{float}
\usepackage{bm}
\usepackage{graphicx}
\usepackage{physics}
\usepackage{subcaption}
\graphicspath{{../gambar/}}

\begin{document}
\section{Bimbingan}
\subsection{Apa itu metode pseudospectral Method}
Pseudospectral Method (PSM) adalah metode numerik untuk menyelesaikan persamaan diferensial dengan mengaproksimasi fungsi menggunakan polinomial ortogonal (biasanya Chebyshev atau Legendre).

Berbeda dengan metode numerik konvensional (seperti Euler atau Runge-Kutta) yang mendiskritisasi waktu secara seragam, PSM menggunakan \textbf{titik kolokasi nonuniform}\textsuperscript{(1)} yang mengikuti distribusi akar atau ekstrem dari polinomial ortogonal. Tujuannya adalah untuk mencapai akurasi sangat tinggi (eksponensial) dengan jumlah titik yang jauh lebih sedikit.

\begin{flushleft}
\textsuperscript{(1)} Titik kolokasi adalah titik-titik tertentu dalam domain waktu (atau ruang) di mana persamaan diferensial dianggap “benar” secara eksak.
\end{flushleft}
Kalau begitu apa bedanya dengan diskritisasi? \\
jawab: Diskritisasi adalah proses \textbf{membagi domain waktu} menjadi titik-titik diskret untuk menghitung solusi numerik lokal, sedangkan kolokasi adalah \textbf{memilih titik diskret khusus} untuk memaksa persamaan diferensial “benar” pada titik-titik itu, lalu membangun solusi global berbasis polinomial.

Disinilah letak mengapa diperlukan PSM pada NMPC, sebab PSM membuat NMPC lebih cepat karena ia mengganti integrasi langkah demi langkah dengan aproksimasi polinomial global berorde tinggi yang langsung bisa dimasukkan ke dalam optimasi nonlinear. 

\subsection{Polinomial Chebyshev}
Polinomial Chebyshev adalah dua deret polinomial ortogonal yang berhubungan dengan fungsi kosinus dan sinus, dinotasikan sebagai $T_n(x)$ dan $U_n(x)$. Dengan
\[
T_n(\cos (\theta)) = \cos (n\theta)
\]
\[
U_n(\cos(\theta))\sin\theta = \sin((n+1)\theta)
\]
Artinya jika $x = \cos\theta$, maka
\[
T_0 = 1, \quad T_1=\cos(\theta), \quad T_2=\cos(2\theta), \quad T_3=\cos(3\theta)
\]
Dengan contoh polinomial pertama yaitu:
\begin{table}[H]
    \centering
    \begin{tabular}{c c}
        \toprule
        $n$ & $T_n(x)$ \\
        \midrule
        0 & $1$ \\
        1 & $x$ \\
        2 & $2x^2 - 1$ \\
        3 & $4x^3 - 3x$ \\
        4 & $8x^4 - 8x^2 + 1$ \\
        \bottomrule
    \end{tabular}
\end{table}

\subsection{Chebyshev Pseudospectral Method}
Metode Chebyshev Pseudospectral adalah salah satu dari PSM yang menggunakan Chebyshev–Gauss–Lobatto (CGL) sebegai titik-titik kolokasi. Titik ini berasal dari ekstrem (maksimum dan minimum) polinomial Chebyshev $T_n(x)$. Berikut adalah langkah-langkah memperoleh Chebyshev–Gauss–Lobatto (CGL).
Definisi dasar Chebyshev:
\[
T_n(x) = \cos(n\theta), \qquad x = \cos(\theta)
\]
Langkah 1: Cari titik ekstrem (maksimum dan minimum) \\
Titik ekstrem diperoleh saat turunan terhadap $x$ bernilai nol:
\[
\frac{dT_n(x)}{dx} = 0
\]
Karena $x = \cos\theta$, gunakan turunan rantai:
\[
\frac{dT_n(x)}{dx} = 
\frac{dT_n}{d\theta} \cdot \frac{d\theta}{dx}
\]
Kita tahu:
\[
T_n(x) = \cos(n\theta)
\quad \Rightarrow \quad 
\frac{dT_n}{d\theta} = -n \sin(n\theta)
\]
dan
\[
\frac{d\theta}{dx} = -\frac{1}{\sqrt{1 - x^2}}
\]
Sehingga:
\[
\frac{dT_n}{dx} = 
\frac{n \sin(n\theta)}{\sqrt{1 - x^2}}
\]
Langkah 2: Syarat ekstrem → nolkan turunan \\

\[
\frac{dT_n}{dx} = 0 
\quad \Rightarrow \quad 
\sin(n\theta) = 0
\]
Solusi:
\[
n\theta_i = i\pi, 
\qquad i = 0, 1, 2, \ldots, n
\]

\[
\Rightarrow \quad 
\theta_i = \frac{i\pi}{n}
\]
Langkah 3: Kembalikan ke $x$ \\

\[
x_i = \cos(\theta_i) 
= \cos\left(\frac{i\pi}{n}\right),
\qquad i = 0, 1, \ldots, n
\]
Nah, inilah rumus \textbf{Chebyshev--Gauss--Lobatto nodes.}

Disebut Chebyshev--Gauss--Lobatto karena berasal teori quadrature (integrasi numerik):
\begin{enumerate}
    \item Gauss quadrature = metode integrasi numerik berbasis akar polinomial ortogonal (misal, Chebyshev atau Legendre).
    \item Lobatto = modifikasi Gauss quadrature yang juga menyertakan titik ujung domain (-1 dan +1).
\end{enumerate}

% \subsection{Langkah-langkah PSM secara umum}
% \subsubsection{Aproksimasi Fungsi}
% Misalkan $x(t)$ adalah fungsi keadaan kontinu pada interval waktu $[t_0, t_f]$.
% PSM mendekati fungsi tersebut dengan deret polinomial ortogonal:
% \[
% x(t) \approx \sum_{k=0}^{N} a_k \, \phi_k(t)
% \]
% di mana $\phi_k(t)$ adalah polinomial basis (misalnya Chebyshev $T_k$ atau Legendre $L_k$) 
% dan $a_k$ adalah koefisien yang akan ditentukan.

% \subsubsection{Kolokasi di Titik Pseudospektral}
% PSM tidak menghitung turunan secara simbolik, tetapi 
% \textbf{mendefinisikan turunan fungsi pada sejumlah titik kolokasi}:

% \[
% \dot{x}(t_i) = f(x(t_i), u(t_i))
% \]
% Titik-titik ini adalah \textbf{titik kolokasi nonuniform} seperti:

% \begin{itemize}[noitemsep]
%     \item \textbf{Chebyshev--Gauss--Lobatto nodes:}
%     \[
%     \tau_i = \cos\left( \frac{i \pi}{N} \right), 
%     \quad i = 0, 1, \ldots, N
%     \]
%     \item \textbf{Legendre--Gauss--Lobatto nodes:}
%     akar dari $(1 - \tau^2)L_N'(\tau) = 0$
% \end{itemize}

% \subsubsection{Diferensiasi via Matriks}
% Turunan dari fungsi yang diaproksimasi bisa dituliskan dalam bentuk 
% \textbf{Chebyshev Differentiation Matrix} ($D$) atau 
% \textbf{Legendre Differentiation Matrix}:

% \[
% \dot{x}(\tau_i) \approx \sum_{j=0}^{N} D_{ij} \, x(\tau_j)
% \]

\subsection{Langkah-langkah Chebyshev Pseudospectral Method (CPM) secara umum}

\subsubsection{Melakukan Aproksimasi Fungsi}
Misalkan terdapat $x(t)$ adalah fungsi kontinu dengan interval waktu $[t_0, t_f]$. Fungsi ini akan diaproksimasi dengan interpolasi polinomial Langrange, namun sebelum itu perlu dilakukan pengubahan domain fungsi yang awalnya pada $[t_0, t_f]$ menjadi pada domain standar $\tau \in [-1,1]$. Hubungan antara waktu sebenarnya dan waktu terstandar diberikan oleh transformasi linear:
\[
\tau = \frac{2(t - t_0)}{t_f - t_0} - 1
\]
Setelah itu fungsi $x(t)$ dapat diaproksimasi dengan polinomial langrange yaitu
\[
x(\tau) = \sum_{i=0}^{N} x_i \, \phi_i(\tau) \label{eq.S_tau}
\]
Dengan N adalah order polinomial dan $\phi_i$ adalah basis fungsi langrange.
\[
    \phi_i(\tau) = \prod_{\substack{j=0 \\ j \ne i}}^{N}\frac{\tau - \tau_j}{\tau_i - \tau_j} \label{eq.phi_tau}
\]

\subsubsection{Kolokasi di Titik Chebyshev--Gauss--Lobatto}

\begin{itemize}[noitemsep]
    \item Pilih node non-uniform:
    \[
    \tau_i = \cos\left( \frac{i\pi}{N} \right), \quad i = 0, 1, \ldots, N.
    \]
    
    \item Node ini mencakup ujung domain $(-1, +1)$ dan rapat di tepi $\Rightarrow$ stabil dan mengurangi osilasi di batas.
    
    \item Persamaan dinamik kontinu $\dot{x}(t) = f(x(t), u(t))$ setelah transformasi waktu menjadi:
    \[
    \frac{2}{t_f - t_0}\dot{x}(\tau_i) = f(x(\tau_i), u(\tau_i)),
    \]
    dan dipaksa benar (kolokasi) pada setiap $\tau_i$.
\end{itemize}

\subsubsection{Diferensiasi via Matriks Chebyshev}

\begin{itemize}[noitemsep]
    \item Turunan aproksimasi Lagrange di titik kolokasi bisa ditulis sebagai operasi matriks:
    \[
    \dot{x}(\tau_i) \approx \sum_{j=0}^{N} D_{ij} x(\tau_j)
    \]
    
    \item Elemen \textbf{Chebyshev differentiation matrix} $D$ untuk node CGL:
    \[
    D_{ij} =
    \begin{cases}
        \dfrac{c_i (-1)^{i+j}}{c_j (\tau_i - \tau_j)}, & i \neq j, \\[8pt]
        -\dfrac{\tau_j}{2(1 - \tau_j^2)}, & i = j, \; j = 1, \ldots, N-1, \\[10pt]
        \dfrac{2N^2 + 1}{6}, & i = j = 0, \\[6pt]
        -\dfrac{2N^2 + 1}{6}, & i = j = N,
    \end{cases}
    \]
    dengan $c_0 = c_N = 2$, dan $c_j = 1$ untuk lainnya.
\end{itemize}

\subsubsection{Formulasi Kolokasi Diskrit}

\begin{itemize}[noitemsep]
    \item Kumpulkan semua state pada node menjadi vektor 
    \[
    X = [x(\tau_0), \ldots, x(\tau_N)]^\top,
    \]
    dan input 
    \[
    U = [u(\tau_0), \ldots, u(\tau_N)]^\top.
    \]
    
    \item Kendala dinamik global (untuk semua node) menjadi sistem aljabar:
    \[
    \frac{2}{t_f - t_0} DX = F(X, U),
    \]
    dengan
    \[
    F(X,U) = [f(x(\tau_0),u(\tau_0)), \ldots, f(x(\tau_N),u(\tau_N))]^\top.
    \]
    
    \item Tambahkan kondisi awal $x(\tau_0) = x(t_0)$ (dan kondisi terminal bila ada).
\end{itemize}

\subsubsection{Kuantifikasi Integral (Quadrature)}

\begin{itemize}[noitemsep]
    \item Integral pada $[-1,1]$ diganti jumlah berbobot (aturan Chebyshev--Gauss--Lobatto):
    \[
    \int_{-1}^{1} g(\tau)\, d\tau \approx \sum_{i=0}^{N} w_i g(\tau_i).
    \]
    \item Gunakan bobot CGL $w_i$; sesuai $N$ genap/ganjil — nanti digunakan untuk biaya (tracking dan effort kontrol).
\end{itemize}

\subsubsection{Formulasi Masalah Optimal Diskrit (OCP $\rightarrow$ NLP)}
\begin{itemize}[noitemsep]
    \item Biaya kontinu:
    \[
    J = \int_{t_0}^{t_f} L(x(t), u(t))\, dt
    \]
    menjadi:
    \[
    J \approx \frac{t_f - t_0}{2} \sum_{i=0}^{N} w_i L(x(\tau_i), u(\tau_i)).
    \]
    
    \item NLP akhir:
    \[
    \begin{aligned}
    \min_{X,U}\quad & J = \frac{t_f - t_0}{2} \sum_{i=0}^{N} w_i L(x_i, u_i) \\
    \text{s.t.} \quad & \frac{2}{t_f - t_0} D X = F(X, U), \quad x_0 = x(t_0), \\
    & \text{kendala state/input lain (box, rate, obstacle, dst).}
    \end{aligned}
    \]
\end{itemize}

\subsection{Contoh Penggunaan Polinomial Chebysev}
Berikut adalah perbandingan polinomial Chebysev dan ode45 dalam menyelesaikan persamaan differensial $\dot{x}=x$.
\begin{figure}[H] 
    \centering 
    \includegraphics[width=0.7 \textwidth]{Chebyshev vs Ode45.png} 
    \caption{Perbandingan polinomial Chebysev dan ode45} 
    \label{fig:perbandingan}
\end{figure}

\subsection{Fungsi tujuan di NMPC apakah diskrit atau kontinu?}
Fungsi tujuan NMPC pada dasarnya bersifat kontinu. Hanya saja, untuk keperluan komputasi numerik, fungsi tujuan harus dalam bentuk diskrit (sigma). Sumber buku:
\begin{figure}[H]
    \centering
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{obj_kontinu.png}
        \caption{Fungsi Objektif Kontinu}
        \label{fig:obj_kontinu}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{obj_diskrit.png}
        \caption{Fungsi Objektif Diskrit}
        \label{fig:obj_diskrit}
    \end{subfigure}
\end{figure}

\subsection{$\tau$ itu apa dan bagaimana?}
Variabel $\tau$ merupakan waktu terstandar (domain komputasi) yang digunakan pada metode Chebyshev. Semua polinomial Chebyshev didefinisikan dan bersifat ortogonal pada interval [-1, 1], sehingga domain ini menjadi ruang dasar untuk aproksimasi dan kolokasi dalam Chebyshev Pseudospectral Method. Berikut adalah contoh perubahan domain waktu biasa dan $\tau$ pada menggambar fungsi.
\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{waktu_tau_vs_biasa.png}
    \caption{Perbandingan waktu biasa vs $\tau$}
    \label{fig:waktu_tau}
\end{figure}


\subsection{Alasan kenapa polinomial Chebyshev digunakan? Bisa bandingin dengan Laguerre dan Langrange}
Ada beberapa kelebihan dari Polinomial Chebyshev yaitu
\begin{enumerate}
    \item Akurasi tinggi (eksponensial konvergen)
    \item Lebih sedikit titik kolokasi dibanding metode grid uniform
\end{enumerate}
Dibalik kelebihan, terdapat kekurangan dari Polinomial Chebyshev, yaitu
\begin{enumerate}
    \item Kurang cocok untuk horizon sangat panjang (clustering di ujung)
    \item Butuh transformasi domain untuk tiap horizon
\end{enumerate}

Jika membandingkan dengan polinomial Laguerre dan Lagrange adalah 
\subsection{Bagaimana aturan dari Diskrit ke kontinu dan bagaimana jika kontinu ke diskrit}

\subsection{Sifat Orthogonalitas berpengaruh dimana?}
Sifat ortogonalitas polinomial Chebyshev menyebabkan setiap basis fungsi bekerja secara independen, sehingga menghindari interferensi antar komponen aproksimasi. Dalam Pseudospectral Method, hal ini meningkatkan kestabilan numerik dan mempercepat konvergensi. Akibatnya, pada implementasi Nonlinear Model Predictive Control (NMPC), prediksi lintasan menjadi lebih akurat dan penyelesaian optimasi lebih efisien.

\subsection{Fungsi COLREGS di Chebyshev}

\subsection{Metodologi}
\subsubsection{Pengkajian Model Kapal}
Pada tahap ini akan menghasilkan model kapal tak linier, yaitu:
\[
\mathbf{\dot{s}} = \mathbf{f}(\mathbf{s},u)
\]
dan model pengukuran
\[
\mathbf{h=Cs}
\]
\subsubsection{Pengubahan domain waktu menjadi domain standar}
Pada tahap ini, waktu yang awalnya pada $[t_0,t_f]$, diubah menjadi domain standar $\tau \in [-1,1]$. Hubungan antara waktu sebenarnya dan waktu terstandar diberikan oleh transformasi linear:
\[
\tau = \frac{2(t-t_0)}{t_f-t_0}-1
\]
Sehingga model kapal yang sebelumnya masih berdomain waktu akan diubah menjadi domain standar $\tau$, dengan 
\[
\tau = \frac{2(t - t_0)}{t_f-t_0} - 1 
\qquad \Longleftrightarrow \qquad 
t = t_0 + \frac{t_f-t_0}{2}(\tau + 1).
\]
Turunkan $t$ terhadap $\tau$:
\[
\frac{dt}{d\tau} = \frac{t_f-t_0}{2}.
\]
Dengan menggunakan aturan rantai untuk turunan terhadap $\tau$, diperoleh
\[
\frac{d\mathbf{s}}{d\tau} = \frac{d\mathbf{s}}{dt} \frac{dt}{d\tau} 
= \mathbf{f}(\mathbf{s}(\tau), u(\tau)) \cdot \frac{t_f-t_0}{2}.
\]
Sehingga persamaan model $\dot{\mathbf{s}} = \mathbf{f}(\mathbf{s},u)$ menjadi $\mathbf{s}(\tau) = \frac{t_f-t_0}{2}\mathbf{f}(\mathbf{s}(\tau),u(\tau))$.

\subsubsection{Aproksimasi fungsi dengan polinomial Langrange}
Fungsi $x(\tau)$ dapat diaproksimasi dengan polinomial Lagrange yaitu
\[
x(\tau) = \sum_{i=0}^{N} x_i \, \phi_i(\tau) \label{eq.S_tau}
\]
Dengan N adalah order polinomial $\phi_i$ adalah basis fungsi Lagrange yaitu
\[
\phi_i(\tau) = \prod_{\substack{j=0 \\ j \ne i}}^{N}\frac{\tau - \tau_j}{\tau_i - \tau_j}
\]
\subsubsection{Kolokasi di Titik Chebyshev-Gauss-Lobatto}
Disinilah inti dari Metode Chebyshev Pseudospectral, sebab titik kolokasi yang digunakan adalah titik Chebyshev–Gauss–Lobatto, yaitu:
\[
\tau_i = \cos\left( \frac{i\pi}{N} \right), \quad i = 0, 1, \ldots, N.
\]
Dengan persaman model adalah
\[
\dot{\mathbf{s}}(\tau_i) = \frac{t_f-t_0}{2}\mathbf{f}(\mathbf{s}(\tau_i),u(\tau_i))
\]
\subsubsection{Diferensiasi via Matriks Chebyshev}
\[
\dot{\mathbf{s}}(\tau_i) \approx \sum_{j=0}^{N} D_{ij} \mathbf{s}(\tau_j)
\]
Elemen \textbf{Chebyshev differentiation matrix} $D$ untuk node CGL:
\[
D_{ij} =
\begin{cases}
    \dfrac{c_i (-1)^{i+j}}{c_j (\tau_i - \tau_j)}, & i \neq j, \\[8pt]
    -\dfrac{\tau_j}{2(1 - \tau_j^2)}, & i = j, \; j = 1, \ldots, N-1, \\[10pt]
    \dfrac{2N^2 + 1}{6}, & i = j = 0, \\[6pt]
    -\dfrac{2N^2 + 1}{6}, & i = j = N,
\end{cases}
\]
dengan $c_0 = c_N = 2$, dan $c_j = 1$ untuk lainnya.\\
Sehingga model kapal menjadi
\[
\sum_{j=0}^{N} D_{ij} \mathbf{s}(\tau_j)= \frac{t_f-t_0}{2}\mathbf{f}(\mathbf{s}(\tau_i),u(\tau_i))
\]

\subsubsection{Kuantifikasi Integral (Quadrature) NMPC}
Integral pada $[-1,1]$ diganti jumlah berbobot (aturan Chebyshev--Gauss--Lobatto):
\[
\int_{-1}^{1} g(\tau)\, d\tau \approx \sum_{i=0}^{N} w_i g(\tau_i).
\]
Sehingga fungsi tujuan yang awalnya adalah 
\[
J = \int_{t_0}^{t_f} L(x(t), u(t))\, dt
\]
menjadi:
\[
J \approx \frac{t_f - t_0}{2} \sum_{i=0}^{N} w_i L(x(\tau_i), (\tau_i)).
\]
untuk $k = 0, \ldots, N$. Untuk $N$ genap, $w_k$ adalah
\[
w_0 = w_N = \frac{1}{N^2 - 1},
\]

\[
w_k = \frac{2}{N} 
\left[
\gamma(0,k) + \gamma\left(\frac{N}{2},k\right) 
+ 2 \sum_{i=1}^{N/2 - 1} \gamma(i,k)
\right],
\]
untuk $k = 1, \ldots, N - 1$, dan untuk $N$  ganjil adalah

\[
w_0 = w_N = \frac{1}{N^2},
\]

\[
w_k = \frac{2}{N} 
\left[
\gamma(0,k) + 2 \sum_{i=1}^{(N-1)/2} \gamma(i,k)
\right],
\]
dengan

\[
\gamma(i,k) = \frac{1}{1 - 4i^2} \cos \qty(\frac{2\pi i k}{N}).
\] 

jelasin metode quadraturenya, fungsi tujuannya. dan hasil fungsi tujuannya


\newpage
\section*{Model Kapal}

\begin{align*}
    \dot{v}' &= a'_{11}v' + a'_{12}r' + b'_1\delta' \\
    \dot{r}' &= a'_{21}v' + a'_{22}r' + b'_2\delta' \\
    \dot{\psi}' &= r' \\
    \dot{x}' &= u'_0 \cos\psi' - v'\sin\psi' \\
    \dot{y}' &= u'_0 \sin\psi' + v'\cos\psi'
\end{align*}
Persamaan ini dapat ditulis menjadi
\begin{align*}
    \dot{\mathbf{S}} = f(\mathbf{S},\mathbf{u})
\end{align*}
Dengan $S = \left[ \begin{matrix}
    v' & r' & \psi' & x' & y'
\end{matrix} \right]^T$. Untuk persamaan model pengukuran output diberikan sebagai berikut

\[
\mathbf{h} = \mathbf{C}\mathbf{S}
\]
dengan

\[
\mathbf{C} = 
\begin{bmatrix}
0 & 0 & 1 & 0 & 0 \\
0 & 0 & 0 & 1 & 0 \\
0 & 0 & 0 & 0 & 1
\end{bmatrix}
\]
Output sistem adalah sudut \textit{yaw}($\psi$), posisi kapal pada sumbu-x ($x$), dan posisi kapal pada sumbu-y ($y$).
\\
Lalu horizon waktu $[t_0, t_0 + T]$ diubah ke domain Chebyshev $\tau \in [-1, 1]$ dengan
\[
\tau = \frac{2(t - t_0)}{T} - 1 
\qquad \Longleftrightarrow \qquad 
t = t_0 + \frac{T}{2}(\tau + 1).
\]
Turunkan $t$ terhadap $\tau$:
\[
\frac{dt}{d\tau} = \frac{T}{2}.
\]
Dengan menggunakan aturan rantai untuk turunan terhadap $\tau$, diperoleh
\[
\frac{dS}{d\tau} = \frac{dS}{dt} \frac{dt}{d\tau} 
= f(S(\tau), u(\tau)) \cdot \frac{T}{2}.
\]
Sehingga persamaan model $\dot{\mathbf{S}} = f(\mathbf{S},\mathbf{u})$ menjadi $\bold{\dot{S}(\tau) = \frac{T}{2}f(S(\tau),u(\tau))}$. \\
Lalu \textbf{S} dan \textbf{U} diaproksimasi dengan interpolasi polinomial Langrange, yaitu
\begin{align}
    S(\tau) = \sum_{i=0}^{N} S_i \, \phi_i(\tau) \label{eq.S_tau}\\
    u(\tau) = \sum_{i=0}^{N} u_i \, \phi_i(\tau) \label{eq.u_tau}
\end{align}
Dengan N adalah order polinomial dan $\phi_i$ adalah basis fungsi langrange.
\begin{align}
    \phi_i(\tau) = \prod_{\substack{j=0 \\ j \ne i}}^{N}\frac{\tau - \tau_j}{\tau_i - \tau_j} \label{eq.phi_tau}
\end{align}
Dari persamaan \eqref{eq.S_tau} diturunkan terhadap $\tau$, sehingga menjadi
\[
\dot{S}(\tau) = \sum_{i=0}^{N} S_i \frac{d\phi_i(\tau)}{d\tau}
\]
Lalu persamaan \eqref{eq.phi_tau} terhadap $\tau$, sehingga menjadi
\[
\phi_i'(\tau) = \phi_i(\tau) 
\sum_{j \ne i} \frac{1}{\tau - \tau_j}
\]
Sehingga diperoleh 
\begin{align*}
    \dot{S}(\tau) = \sum_{i=0}^{N} S_i \phi_i(\tau) \left( 
    \sum_{\substack{j=0 \\ j \ne i}}^{N} \frac{1}{\tau_i - \tau_j} 
    \right)
\end{align*}
Untuk $k = 1, 2, \ldots, N$ pilih titik Chebyshev-Gauss-Lobatto sebagai titik interpolasi yang diberikan oleh
\[
\tau_k = \cos(\frac{\pi k }{N})
\]

\section*{Design NMPC}
\subsection*{Objective Function 1}
\begin{align*}
J(k) = \sum_{i=1}^{N_p} 
\left\| \mathbf{h}_{\text{ref}}(k+i|k) - \mathbf{h}(k+i|k) \right\|_{Q_{(i)}}^{2}
+ 
\left\| \Delta \mathbf{u}(k+i-1|k) \right\|_{R_{(i)}}^{2}
\end{align*}
dengan kendala

\begin{align*}
\mathbf{s}(k+i|k) &= \mathbf{f}_d\big(\mathbf{s}(k+i-1|k), \mathbf{u}(k+i-1|k)\big) \\
\mathbf{h}(k+i|k) &= \mathbf{C}\mathbf{s}(k+i|k) \\
\mathbf{s}_{\min} &\leq \mathbf{s}(k+i|k) \leq \mathbf{s}_{\max} \\
\mathbf{u}_{\min} &\leq \mathbf{u}(k+i-1|k) \leq \mathbf{u}_{\max} \\
\Delta \mathbf{u}_{\min} &\leq \Delta \mathbf{u}(k+i-1|k) \leq \Delta \mathbf{u}_{\max}
\end{align*}
untuk $i = 1, 2, \ldots, N_p$. Dengan $\Delta \mathbf{u}(k) = \mathbf{u}(k) - \mathbf{u}(k-1)$ 

\subsection*{Dengan Chebyshev}
Karena $\Delta \mathbf{u}(k) = \mathbf{u}(k) - \mathbf{u}(k-1)$ dapat diaproksimasi menjadi turunan $\mathbf{u}$ yaitu berdasarkan \eqref{eq.u_tau}, diperoleh

\[
u(\tau) = \sum_{i=0}^{N} u_i \, \phi_i(\tau), 
\qquad \tau \in [-1, 1].
\]
Turunan terhadap waktu:

\begin{align*}
    \dot{u}(t) = \frac{du}{dt} 
= \frac{2}{T} \frac{du}{d\tau} \\
\left.\frac{du}{d\tau}\right|_{\tau_k} 
= \sum_{i=0}^{N} D_{ki} u_i,
\end{align*}
Sehingga fungsi tujuan menjadi:

\begin{align*}
J = \frac{T}{2} \sum_{k=0}^{N} w_k 
\left[ 
\left\| h(x_k) - h_d(\tau_k) \right\|_{Q}^{2} 
+ 
\left\| \frac{2}{T} \sum_{i=0}^{N} D_{ki} u_i \right\|_{R}^{2}
\right]
\end{align*}
Dengan kendala
\begin{align*}
    \sum_{i=0}^{N} D_{ki} s_i &= \frac{T}{2}f(S(\tau), u(\tau)) \\
    h_k &= C s_k \\
    s_{\min} \leq &s_k \leq s_{\max} \\
    u_{\min} \leq &u_k \leq u_{\max} \\
    \dot{u}_{\min} \leq \frac{2}{T} &\sum_{i=0}^{N} D_{ki} u_i \leq \dot{u}_{\max} \\
\end{align*}
untuk $k = 0, \ldots, N$. Untuk $N$ genap, $w_k$ adalah
\[
w_0 = w_N = \frac{1}{N^2 - 1},
\]

\[
w_k = \frac{2}{N} 
\left[
\gamma(0,k) + \gamma\left(\frac{N}{2},k\right) 
+ 2 \sum_{i=1}^{N/2 - 1} \gamma(i,k)
\right],
\]
untuk $k = 1, \ldots, N - 1$, dan untuk $N$  ganjil adalah

\[
w_0 = w_N = \frac{1}{N^2},
\]

\[
w_k = \frac{2}{N} 
\left[
\gamma(0,k) + 2 \sum_{i=1}^{(N-1)/2} \gamma(i,k)
\right],
\]
dengan

\[
\gamma(i,k) = \frac{1}{1 - 4i^2} \cos \qty(\frac{2\pi i k}{N}).
\] 
Dan $D_{ki}$ adalah evaluasi turunan pada titik kolokasi $\tau = \tau_k$ menghasilkan elemen dari matriks diferensiasi Chebyshev–Gauss–Lobatto (CGL):
\begin{equation}
    D_{ki} = \phi_i'(\tau_k) \label{eq.DKi}
\end{equation} 
Matriks diferensiasi $D_{ki}$ dapat dinyatakan secara eksplisit sebagai:
\begin{equation}
D_{ki} = 
\begin{cases}
\dfrac{c_k}{c_i}\dfrac{(-1)^{k+i}}{\tau_k - \tau_i}, & k \neq i, \\[8pt]
-\dfrac{\tau_k}{2(1-\tau_k^2)}, & 1 \le k \le N-1, \\[8pt]
\dfrac{2N^2 + 1}{6}, & k = 0, \\[6pt]
-\dfrac{2N^2 + 1}{6}, & k = N,
\end{cases}
\label{eq:Dki}
\end{equation}
dengan $c_0 = c_N = 2$ dan $c_i = 1$ untuk $i = 1, 2, \ldots, N-1$.

\subsection*{Simulasi NMPC dengan CASADI hasil ChatGPT}
\begin{figure}[h]
    \centering
    % ===== Gambar kiri =====
    \begin{subfigure}{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{CHEBYSEV_NMPC.png}
        \caption{Simulasi NMPC dengan Chebyshev}
        \label{fig:Chebyshev}
    \end{subfigure}
    \hfill
    % ===== Gambar kanan =====
    \begin{subfigure}{0.35\textwidth}
        \centering
        \includegraphics[width=\textwidth]{NMPC_BIASA.png}
        \caption{Simulasi NMPC konvensional}
        \label{fig:nmpc}
    \end{subfigure}

    \caption{Perbandingan hasil simulasi antara NMPC Chebyshev dan NMPC biasa.}
    \label{fig:comparison}
\end{figure}

\subsection*{Catatan}
N : Orde polinomial Chebyshev \\
i : indeks indeks titik basis Lagrange (atau node tempat state/variabel disimpan) \\
k : indeks titik kolokasi tempat turunan sistem dipaksakan berlaku

\newpage
\section*{Coret-Coret}
Dengan $s=[\,v' \ r' \ \psi' \ x' \ y'\,]^\top$, kendali $u'=\delta'$, dan kecepatan surge konstan $u'_0$, model takliniernya:
\[
\dot s = f(s,u') \equiv
\begin{bmatrix}
-0.6174\,v' - 0.1036\,r' + 0.01\,u'\\
-5.0967\,v' - 3.4047\,r' + u'\\
r'\\
u'_0\cos\psi' - v'\sin\psi'\\
u'_0\sin\psi' + v'\cos\psi'
\end{bmatrix}.
\]

Ambil titik CGL untuk $N=4$ dan $T=5$:
\[
\tau_0=1,\quad \tau_1=\tfrac{\sqrt2}{2},\quad \tau_2=0,\quad
\tau_3=-\tfrac{\sqrt2}{2},\quad \tau_4=-1,
\]
dan tulis $S_i:=S(\tau_i)=[\,v'_i\ r'_i\ \psi'_i\ x'_i\ y'_i\,]^\top$, $u_i':=u'(\tau_i)$.

\paragraph{Persamaan kolokasi.}
Untuk setiap $k=0,\dots,4$ berlaku
\[
\sum_{i=0}^{4} D_{ki}\,S_i \;=\; \frac{T}{2}\, f(S_k,u'_k)
\;=\; 5\, f(S_k,u'_k),
\]
yang komponen–per–komponen menjadi
\begin{align*}
\sum_{i=0}^{4} D_{ki}\,v'_i &= 5\Big(-0.6174\,v'_k - 0.1036\,r'_k + 0.01\,u'_k\Big),\\
\sum_{i=0}^{4} D_{ki}\,r'_i &= 5\Big(-5.0967\,v'_k - 3.4047\,r'_k + u'_k\Big),\\
\sum_{i=0}^{4} D_{ki}\,\psi'_i &= 5\,r'_k,\\
\sum_{i=0}^{4} D_{ki}\,x'_i &= 5\Big(u'_0\cos\psi'_k - v'_k\sin\psi'_k\Big),\\
\sum_{i=0}^{4} D_{ki}\,y'_i &= 5\Big(u'_0\sin\psi'_k + v'_k\cos\psi'_k\Big).
\end{align*}

\paragraph{Matriks diferensiasi CGL ($N=4$).}
\[
D=\begin{bmatrix}
  5.50000000 & -6.82842712 &  2.00000000 & -1.17157288 &  0.50000000\\
  1.70710678 & -0.70710678 & -1.41421356 &  0.70710678 & -0.29289322\\
 -0.50000000 &  1.41421356 &  0.00000000 & -1.41421356 &  0.50000000\\
  0.29289322 & -0.70710678 &  1.41421356 &  0.70710678 & -1.70710678\\
 -0.50000000 &  1.17157288 & -2.00000000 &  6.82842712 & -5.50000000
\end{bmatrix}.
\]
maka persamaan menjadi

\paragraph{(1) Komponen $v'$:}
\begin{align*}
5.5v'_0 - 6.8284v'_1 + 2v'_2 - 1.1716v'_3 + 0.5v'_4 &= 5(-0.6174v'_0 - 0.1036r'_0 + 0.01u'_0),\\
1.7071v'_0 - 0.7071v'_1 - 1.4142v'_2 + 0.7071v'_3 - 0.2929v'_4 &= 5(-0.6174v'_1 - 0.1036r'_1 + 0.01u'_1),\\
-0.5v'_0 + 1.4142v'_1 - 1.4142v'_3 + 0.5v'_4 &= 5(-0.6174v'_2 - 0.1036r'_2 + 0.01u'_2),\\
0.2929v'_0 - 0.7071v'_1 + 1.4142v'_2 + 0.7071v'_3 - 1.7071v'_4 &= 5(-0.6174v'_3 - 0.1036r'_3 + 0.01u'_3),\\
-0.5v'_0 + 1.1716v'_1 - 2v'_2 + 6.8284v'_3 - 5.5v'_4 &= 5(-0.6174v'_4 - 0.1036r'_4 + 0.01u'_4).
\end{align*}

\paragraph{(2) Komponen $r'$:}
\begin{align*}
5.5r'_0 - 6.8284r'_1 + 2r'_2 - 1.1716r'_3 + 0.5r'_4 &= 5(-5.0967v'_0 - 3.4047r'_0 + u'_0),\\
1.7071r'_0 - 0.7071r'_1 - 1.4142r'_2 + 0.7071r'_3 - 0.2929r'_4 &= 5(-5.0967v'_1 - 3.4047r'_1 + u'_1),\\
-0.5r'_0 + 1.4142r'_1 - 1.4142r'_3 + 0.5r'_4 &= 5(-5.0967v'_2 - 3.4047r'_2 + u'_2),\\
0.2929r'_0 - 0.7071r'_1 + 1.4142r'_2 + 0.7071r'_3 - 1.7071r'_4 &= 5(-5.0967v'_3 - 3.4047r'_3 + u'_3),\\
-0.5r'_0 + 1.1716r'_1 - 2r'_2 + 6.8284r'_3 - 5.5r'_4 &= 5(-5.0967v'_4 - 3.4047r'_4 + u'_4).
\end{align*}

\paragraph{(3) Komponen $\psi'$:}
\begin{align*}
5.5\psi'_0 - 6.8284\psi'_1 + 2\psi'_2 - 1.1716\psi'_3 + 0.5\psi'_4 &= 5r'_0,\\
1.7071\psi'_0 - 0.7071\psi'_1 - 1.4142\psi'_2 + 0.7071\psi'_3 - 0.2929\psi'_4 &= 5r'_1,\\
-0.5\psi'_0 + 1.4142\psi'_1 - 1.4142\psi'_3 + 0.5\psi'_4 &= 5r'_2,\\
0.2929\psi'_0 - 0.7071\psi'_1 + 1.4142\psi'_2 + 0.7071\psi'_3 - 1.7071\psi'_4 &= 5r'_3,\\
-0.5\psi'_0 + 1.1716\psi'_1 - 2\psi'_2 + 6.8284\psi'_3 - 5.5\psi'_4 &= 5r'_4.
\end{align*}

\paragraph{(4) Komponen $x'$:}
\begin{align*}
5.5x'_0 - 6.8284x'_1 + 2x'_2 - 1.1716x'_3 + 0.5x'_4 &= 5(u'_0\cos\psi'_0 - v'_0\sin\psi'_0),\\
1.7071x'_0 - 0.7071x'_1 - 1.4142x'_2 + 0.7071x'_3 - 0.2929x'_4 &= 5(u'_0\cos\psi'_1 - v'_1\sin\psi'_1),\\
-0.5x'_0 + 1.4142x'_1 - 1.4142x'_3 + 0.5x'_4 &= 5(u'_0\cos\psi'_2 - v'_2\sin\psi'_2),\\
0.2929x'_0 - 0.7071x'_1 + 1.4142x'_2 + 0.7071x'_3 - 1.7071x'_4 &= 5(u'_0\cos\psi'_3 - v'_3\sin\psi'_3),\\
-0.5x'_0 + 1.1716x'_1 - 2x'_2 + 6.8284x'_3 - 5.5x'_4 &= 5(u'_0\cos\psi'_4 - v'_4\sin\psi'_4).
\end{align*}

\paragraph{(5) Komponen $y'$:}
\begin{align*}
5.5y'_0 - 6.8284y'_1 + 2y'_2 - 1.1716y'_3 + 0.5y'_4 &= 5(u'_0\sin\psi'_0 + v'_0\cos\psi'_0),\\
1.7071y'_0 - 0.7071y'_1 - 1.4142y'_2 + 0.7071y'_3 - 0.2929y'_4 &= 5(u'_0\sin\psi'_1 + v'_1\cos\psi'_1),\\
-0.5y'_0 + 1.4142y'_1 - 1.4142y'_3 + 0.5y'_4 &= 5(u'_0\sin\psi'_2 + v'_2\cos\psi'_2),\\
0.2929y'_0 - 0.7071y'_1 + 1.4142y'_2 + 0.7071y'_3 - 1.7071y'_4 &= 5(u'_0\sin\psi'_3 + v'_3\cos\psi'_3),\\
-0.5y'_0 + 1.1716y'_1 - 2y'_2 + 6.8284y'_3 - 5.5y'_4 &= 5(u'_0\sin\psi'_4 + v'_4\cos\psi'_4).
\end{align*}




\newpage
\section*{Materi}
\section*{Chebyshev-Gauss-Lobatto (CGL)}
CGL adalah sekumpulan titik kolokasi (collocation points) yang digunakan dalam metode pseudospectral untuk mendiskritisasi fungsi kontinu menjadi bentuk polinomial berderajat N.
CGL merupakan special case dari titik Chebyshev-Gauss (CG), tetapi dengan tambahan dua titik batas $(-1,1)$ sehingga domainnya lengkap di interval $[-1,1]$. Titik ini didefinisikan sebagai:
\[
\tau_k = \cos \left(\frac{\pi k}{N} \right)
\]
Note:
\begin{enumerate}
    \item Titik kolokasi adalah sekumpulan titik diskrit di sepanjang domain waktu atau ruang tempat persamaan diferensial sistem dipaksakan berlaku secara eksak
    \item Metode pseudospectral adalah metode numerik untuk menyelesaikan persamaan diferensial atau masalah kontrol optimal dengan cara: \begin{enumerate}
        \item Mengaproksimasi fungsi keadaan dan kontrol menggunakan polinomial ortogonal orde tinggi (seperti Chebyshev atau Legendre)
        \item Menentukan turunan dan integralnya hanya di titik-titik kolokasi (biasanya titik-titik Chebyshev–Gauss–Lobatto atau Legendre–Gauss–Lobatto)
    \end{enumerate}
\end{enumerate}

\section*{Pembukatian $D_{ki}$}
Kita mulai dari definisi fungsi basis Lagrange untuk titik-titik kolokasi $\{\tau_j\}_{j=0}^N$:
\begin{equation}
    \phi_i(\tau) = \prod_{\substack{j=0 \\ j \ne i}}^{N} \frac{\tau - \tau_j}{\tau_i - \tau_j},
    \qquad
    \phi_i(\tau_k) = \delta_{ik}.
\end{equation}

Turunan terhadap $\tau$ diberikan oleh
\begin{equation}
    \phi_i'(\tau) = \phi_i(\tau) 
    \sum_{\substack{j=0 \\ j \ne i}}^{N} \frac{1}{\tau - \tau_j}.
\end{equation}

Evaluasi pada titik kolokasi $\tau = \tau_k$ memberikan elemen matriks diferensiasi:
\begin{equation}
    D_{ki} = \phi_i'(\tau_k).
\end{equation}

\subsection*{Bentuk Umum dengan Bobot Barisentris}

Untuk sebarang himpunan titik kolokasi, definisikan bobot barisentris sebagai:
\begin{equation}
    w_i = \frac{1}{\displaystyle \prod_{\substack{m=0 \\ m \ne i}}^{N} (\tau_i - \tau_m)}.
\end{equation}

Dengan bobot tersebut, turunan fungsi basis pada titik-titik kolokasi dapat dinyatakan sebagai
\begin{equation}
    D_{ki} =
    \begin{cases}
        \dfrac{w_i}{w_k} \dfrac{1}{\tau_k - \tau_i}, & k \ne i, \\[8pt]
        -\displaystyle\sum_{\substack{m=0 \\ m \ne k}}^{N} D_{km}, & k = i.
    \end{cases}
    \label{eq:Dki_general}
\end{equation}

\subsection*{Khusus untuk Titik Chebyshev--Gauss--Lobatto (CGL)}

Untuk titik-titik Chebyshev-Gauss-Lobatto yang didefinisikan sebagai
\begin{equation}
    \tau_j = \cos\!\left(\frac{\pi j}{N}\right), \qquad j = 0, 1, \dots, N,
\end{equation}
bobot barisentrisnya memiliki bentuk proporsional sebagai berikut:
\begin{equation}
    w_j \propto (-1)^j \, c_j,
    \qquad
    c_0 = c_N = \tfrac{1}{2}, \quad c_j = 1 \text{ untuk } j = 1, \dots, N-1.
\end{equation}

Substitusi ke dalam Persamaan~\eqref{eq:Dki_general} menghasilkan
\begin{equation}
    \boxed{
    D_{ki} = \frac{c_k}{c_i} \frac{(-1)^{k+i}}{\tau_k - \tau_i}, \qquad k \ne i.
    }
    \label{eq:Dki_offdiag}
\end{equation}

Untuk elemen diagonal diperoleh dengan memanfaatkan sifat baris-jumlah-nol
$\sum_{m=0}^N D_{km} = 0$, sehingga
\begin{equation}
    D_{kk} = - \sum_{\substack{m=0 \\ m \ne k}}^{N} D_{km}.
\end{equation}

Setelah disederhanakan menggunakan identitas trigonometri
$\tau_k = \cos\left(\frac{\pi k}{N}\right)$, bentuk eksplisitnya adalah
\begin{equation}
    \boxed{
    D_{kk} =
    \begin{cases}
        -\dfrac{\tau_k}{2(1 - \tau_k^2)}, & 1 \le k \le N-1, \\[8pt]
        \dfrac{2N^2 + 1}{6}, & k = 0, \\[8pt]
        -\dfrac{2N^2 + 1}{6}, & k = N.
    \end{cases}
    }
    \label{eq:Dki_diag}
\end{equation}

\subsection*{Hasil Akhir}

Maka, matriks diferensiasi Chebyshev--Gauss--Lobatto dapat dinyatakan secara lengkap sebagai:
\begin{equation}
    \boxed{
    D_{ki} =
    \begin{cases}
        \dfrac{c_k}{c_i} \dfrac{(-1)^{k+i}}{\tau_k - \tau_i}, & k \ne i, \\[8pt]
        -\dfrac{\tau_k}{2(1 - \tau_k^2)}, & 1 \le k \le N-1, \\[8pt]
        \dfrac{2N^2 + 1}{6}, & k = 0, \\[8pt]
        -\dfrac{2N^2 + 1}{6}, & k = N.
    \end{cases}
    }
\end{equation}

Bentuk inilah yang digunakan sebagai \textit{differentiation matrix} $D_{ki}$ dalam metode
\textit{Chebyshev pseudospectral}, yang merepresentasikan turunan fungsi kontinu terhadap
variabel $\tau$ pada titik-titik kolokasi $\tau_k \in [-1,1]$.
\end{document}